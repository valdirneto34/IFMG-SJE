<?xml version="1.0" encoding="UTF-8" ?>
<project name="Projeto_Final_BD2_PostgreSQL" database="PostgreSQL" id="16f01159-2c18-4b06-bcda-09f8a589986c" >
	<schema name="escola_idiomas" >
		<table name="alunos" prior="aluno" >
			<column name="aluno_id" type="integer" mandatory="y" />
			<column name="nivel_proeficiencia_inicial" type="varchar" length="20" />
			<index name="pk_alunos" unique="PRIMARY_KEY" >
				<column name="aluno_id" />
			</index>
			<fk name="fk_alunos_pessoas" to_schema="escola_idiomas" to_table="pessoas" >
				<fk_column name="aluno_id" pk="pessoa_id" />
			</fk>
		</table>
		<table name="avaliacoes" prior="avaliac" >
			<column name="avaliacao_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="matricula_id" type="integer" />
			<column name="professor_id" type="integer" />
			<column name="data_avaliacao" type="date" />
			<column name="tipo_avaliacao" type="varchar" length="50" />
			<column name="nota" type="decimal" length="4" decimal="2" />
			<index name="pk_avaliacoes" unique="PRIMARY_KEY" >
				<column name="avaliacao_id" />
			</index>
			<constraint name="chk_valor_nota" >
				<string><![CDATA[nota >= 0 AND nota <= 10.0]]></string>
			</constraint>
			<constraint name="chk_tipo_avaliacao" >
				<string><![CDATA[tipo_avaliacao IN ('Prova', 'Trabalho', 'Quiz', 'Participação')]]></string>
			</constraint>
			<fk name="fk_avaliacoes_matriculas" to_schema="escola_idiomas" to_table="matriculas" >
				<fk_column name="matricula_id" pk="matricula_id" />
			</fk>
			<fk name="fk_avaliacoes_professores" to_schema="escola_idiomas" to_table="professores" >
				<fk_column name="professor_id" pk="professor_id" />
			</fk>
		</table>
		<table name="cursos" prior="curso" >
			<column name="curso_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="idioma_id" type="integer" />
			<column name="nome_curso" type="varchar" length="100" />
			<column name="descricao" type="varchar" length="255" />
			<column name="duracao_meses" type="integer" />
			<index name="pk_cursos" unique="PRIMARY_KEY" >
				<column name="curso_id" />
			</index>
			<constraint name="chk_duracao" >
				<string><![CDATA[duracao_meses > 0]]></string>
			</constraint>
			<fk name="fk_cursos_idiomas" to_schema="escola_idiomas" to_table="idiomas" >
				<fk_column name="idioma_id" pk="idioma_id" />
			</fk>
		</table>
		<table name="formas_pagamento" prior="formas_pagamen" >
			<column name="forma_pagamento_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="descricao" type="varchar" length="50" />
			<index name="pk_formas_pagamento" unique="PRIMARY_KEY" >
				<column name="forma_pagamento_id" />
			</index>
		</table>
		<table name="idiomas" prior="idio" >
			<column name="idioma_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="nome_idioma" type="varchar" length="50" />
			<index name="pk_idiomas" unique="PRIMARY_KEY" >
				<column name="idioma_id" />
			</index>
			<index name="unq_idiomas_nome_idioma" unique="UNIQUE_INDEX" >
				<column name="nome_idioma" />
			</index>
		</table>
		<table name="matriculas" prior="matricu" >
			<column name="matricula_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="aluno_id" type="integer" />
			<column name="turma_id" type="integer" />
			<column name="data_matricula" type="date" />
			<column name="valor_total_curso" type="decimal" length="10" decimal="2" />
			<column name="status_mat" prior="status_matricula" type="varchar" length="20" />
			<index name="pk_matriculas" unique="PRIMARY_KEY" >
				<column name="matricula_id" />
			</index>
			<constraint name="chk_status" >
				<string><![CDATA[status_mat IN ('Ativa', 'Inativa', 'Concluída')]]></string>
			</constraint>
			<fk name="fk_matriculas_alunos" to_schema="escola_idiomas" to_table="alunos" >
				<fk_column name="aluno_id" pk="aluno_id" />
			</fk>
			<fk name="fk_matriculas_turmas" to_schema="escola_idiomas" to_table="turmas" >
				<fk_column name="turma_id" pk="turma_id" />
			</fk>
		</table>
		<table name="mensalidades" prior="mensalida" >
			<column name="matricula_id" type="integer" mandatory="y" />
			<column name="numero_parcela" type="integer" mandatory="y" />
			<column name="forma_pagamento_id" type="integer" />
			<column name="data_vencimento" type="date" />
			<column name="valor_nominal" type="decimal" length="10" decimal="2" />
			<column name="status_pag" type="varchar" length="20" />
			<column name="data_pag" type="date" />
			<column name="valor_pag" type="decimal" length="10" decimal="2" />
			<index name="pk_mensalidades" unique="PRIMARY_KEY" >
				<column name="matricula_id" />
				<column name="numero_parcela" />
			</index>
			<constraint name="chk_mensalidades_status_pag" >
				<string><![CDATA[status_pag IN ('Pendente', 'Vencido', 'Pago')]]></string>
			</constraint>
			<fk name="fk_mensalidades_formas_pagamento" to_schema="escola_idiomas" to_table="formas_pagamento" >
				<fk_column name="forma_pagamento_id" pk="forma_pagamento_id" />
			</fk>
			<fk name="fk_mensalidades_matriculas" to_schema="escola_idiomas" to_table="matriculas" >
				<fk_column name="matricula_id" pk="matricula_id" />
			</fk>
		</table>
		<table name="pessoas" prior="pess" >
			<column name="pessoa_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="nome" type="varchar" length="100" />
			<column name="data_nasc" type="date" />
			<column name="cpf" type="varchar" length="11" mandatory="y" />
			<column name="email" type="varchar" length="100" mandatory="y" />
			<column name="telefone" type="varchar" length="15" />
			<column name="endereco" type="varchar" length="255" />
			<index name="pk_pessoas" unique="PRIMARY_KEY" >
				<column name="pessoa_id" />
			</index>
			<index name="unq_pessoas" unique="UNIQUE_INDEX" >
				<column name="cpf" />
			</index>
			<index name="unq_pessoas_0" unique="UNIQUE_INDEX" >
				<column name="email" />
			</index>
			<constraint name="chk_email" >
				<string><![CDATA[email LIKE '%@%.%']]></string>
			</constraint>
		</table>
		<table name="professores" prior="professor" >
			<column name="professor_id" type="integer" mandatory="y" />
			<column name="especialidade" type="varchar" length="50" />
			<column name="data_contratacao" type="date" />
			<column name="salario" type="decimal" length="10" decimal="2" />
			<index name="pk_professor" unique="PRIMARY_KEY" >
				<column name="professor_id" />
			</index>
			<constraint name="chk_salario" >
				<string><![CDATA[salario > 0]]></string>
			</constraint>
			<fk name="fk_professores_pessoas" to_schema="escola_idiomas" to_table="pessoas" >
				<fk_column name="professor_id" pk="pessoa_id" />
			</fk>
		</table>
		<table name="salas" prior="sal" >
			<column name="sala_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="nome_sala" type="varchar" length="30" />
			<column name="capacidade" type="integer" />
			<column name="tipo_sala" type="varchar" length="50" />
			<index name="pk_salas" unique="PRIMARY_KEY" >
				<column name="sala_id" />
			</index>
			<constraint name="chk_capacidade" >
				<string><![CDATA[capacidade > 0]]></string>
			</constraint>
			<constraint name="chk_tipo" >
				<string><![CDATA[tipo_sala IN ('Comum', 'Laboratório', 'Auditório')]]></string>
			</constraint>
		</table>
		<table name="turmas" prior="tur" >
			<column name="turma_id" type="integer" mandatory="y" >
				<identity><![CDATA[GENERATED BY DEFAULT AS IDENTITY]]></identity>
			</column>
			<column name="curso_id" type="integer" />
			<column name="professor_id" type="integer" />
			<column name="sala_id" type="integer" />
			<column name="nome_turma" type="varchar" length="50" />
			<column name="horario" type="varchar" length="100" />
			<column name="data_inicio" type="date" />
			<column name="data_fim" type="date" />
			<index name="pk_turmas" unique="PRIMARY_KEY" >
				<column name="turma_id" />
			</index>
			<fk name="fk_turmas_cursos" to_schema="escola_idiomas" to_table="cursos" >
				<fk_column name="curso_id" pk="curso_id" />
			</fk>
			<fk name="fk_turmas_professores" to_schema="escola_idiomas" to_table="professores" >
				<fk_column name="professor_id" pk="professor_id" />
			</fk>
			<fk name="fk_turmas_salas" to_schema="escola_idiomas" to_table="salas" >
				<fk_column name="sala_id" pk="sala_id" />
			</fk>
		</table>
	</schema>
	<layout name="Default Diagram" id="5f8b30a8-7f00-4b53-ac54-76be7eb3f551" show_column_type="y" show_relation="columns" >
		<entity schema="escola_idiomas" name="alunos" color="C1D8EE" x="323" y="76" />
		<entity schema="escola_idiomas" name="professores" color="C1D8EE" x="361" y="551" />
		<entity schema="escola_idiomas" name="cursos" color="C1D8EE" x="323" y="209" />
		<entity schema="escola_idiomas" name="pessoas" color="C1D8EE" x="57" y="114" />
		<entity schema="escola_idiomas" name="idiomas" color="C1D8EE" x="133" y="418" />
		<entity schema="escola_idiomas" name="salas" color="C1D8EE" x="836" y="380" />
		<entity schema="escola_idiomas" name="turmas" color="C1D8EE" x="608" y="285" />
		<entity schema="escola_idiomas" name="avaliacoes" color="C1D8EE" x="874" y="570" />
		<entity schema="escola_idiomas" name="formas_pagamento" color="C1D8EE" x="1178" y="418" />
		<entity schema="escola_idiomas" name="mensalidades" color="C1D8EE" x="1083" y="57" />
		<entity schema="escola_idiomas" name="matriculas" color="C1D8EE" x="703" y="57" />
		<script name="SQL_Editor" id="adff916e-2507-446f-b188-2fac41770966" language="SQL" >
			<string><![CDATA[CREATE SCHEMA IF NOT EXISTS escola_idiomas;

CREATE  TABLE escola_idiomas.formas_pagamento ( 
	forma_pagamento_id   integer  NOT NULL  ,
	descricao            varchar(50)    ,
	CONSTRAINT pk_formas_pagamento PRIMARY KEY ( forma_pagamento_id )
 );

CREATE  TABLE escola_idiomas.idiomas ( 
	idioma_id            integer  NOT NULL  ,
	nome_idioma          varchar(50)    ,
	CONSTRAINT pk_idiomas PRIMARY KEY ( idioma_id )
 );

CREATE UNIQUE INDEX unq_idiomas_nome_idioma ON escola_idiomas.idiomas ( nome_idioma );

CREATE  TABLE escola_idiomas.pessoas ( 
	pessoa_id            integer  NOT NULL  ,
	nome                 varchar(100)    ,
	data_nasc            date    ,
	cpf                  varchar(11)  NOT NULL  ,
	email                varchar(100)  NOT NULL  ,
	telefone             varchar(15)    ,
	endereco             varchar(255)    ,
	CONSTRAINT pk_pessoas PRIMARY KEY ( pessoa_id )
 );

ALTER TABLE escola_idiomas.pessoas ADD CONSTRAINT chk_email CHECK ( email LIKE '%@%.%' );

CREATE UNIQUE INDEX unq_pessoas ON escola_idiomas.pessoas ( cpf );

CREATE UNIQUE INDEX unq_pessoas_0 ON escola_idiomas.pessoas ( email );

CREATE  TABLE escola_idiomas.professores ( 
	professor_id         integer  NOT NULL  ,
	especialidade        varchar(50)    ,
	data_contratacao     date    ,
	salario              decimal(10,2)    ,
	CONSTRAINT pk_professor PRIMARY KEY ( professor_id ),
	CONSTRAINT fk_professores_pessoas FOREIGN KEY ( professor_id ) REFERENCES escola_idiomas.pessoas( pessoa_id )   
 );

ALTER TABLE escola_idiomas.professores ADD CONSTRAINT chk_salario CHECK ( salario > 0 );

CREATE  TABLE escola_idiomas.salas ( 
	sala_id              integer  NOT NULL  ,
	nome_sala            varchar(30)    ,
	capacidade           integer    ,
	tipo_sala            varchar(50)    ,
	CONSTRAINT pk_salas PRIMARY KEY ( sala_id )
 );

ALTER TABLE escola_idiomas.salas ADD CONSTRAINT chk_capacidade CHECK ( capacidade > 0 );

ALTER TABLE escola_idiomas.salas ADD CONSTRAINT chk_tipo CHECK ( tipo_sala IN ('Comum', 'Laboratório', 'Auditório') );

CREATE  TABLE escola_idiomas.alunos ( 
	aluno_id             integer  NOT NULL  ,
	nivel_proeficiencia_inicial varchar(20)    ,
	CONSTRAINT pk_alunos PRIMARY KEY ( aluno_id ),
	CONSTRAINT fk_alunos_pessoas FOREIGN KEY ( aluno_id ) REFERENCES escola_idiomas.pessoas( pessoa_id )   
 );

CREATE  TABLE escola_idiomas.cursos ( 
	curso_id             integer  NOT NULL  ,
	idioma_id            integer    ,
	nome_curso           varchar(100)    ,
	descricao            varchar(255)    ,
	duracao_meses        integer    ,
	CONSTRAINT pk_cursos PRIMARY KEY ( curso_id ),
	CONSTRAINT fk_cursos_idiomas FOREIGN KEY ( idioma_id ) REFERENCES escola_idiomas.idiomas( idioma_id )   
 );

ALTER TABLE escola_idiomas.cursos ADD CONSTRAINT chk_duracao CHECK ( duracao_meses > 0 );

CREATE  TABLE escola_idiomas.turmas ( 
	turma_id             integer  NOT NULL  ,
	curso_id             integer    ,
	professor_id         integer    ,
	sala_id              integer    ,
	nome_turma           varchar(50)    ,
	horario              varchar(100)    ,
	data_inicio          date    ,
	data_fim             date    ,
	CONSTRAINT pk_turmas PRIMARY KEY ( turma_id ),
	CONSTRAINT fk_turmas_cursos FOREIGN KEY ( curso_id ) REFERENCES escola_idiomas.cursos( curso_id )   ,
	CONSTRAINT fk_turmas_professores FOREIGN KEY ( professor_id ) REFERENCES escola_idiomas.professores( professor_id )   ,
	CONSTRAINT fk_turmas_salas FOREIGN KEY ( sala_id ) REFERENCES escola_idiomas.salas( sala_id )   
 );

CREATE  TABLE escola_idiomas.matriculas ( 
	matricula_id         integer  NOT NULL  ,
	aluno_id             integer    ,
	turma_id             integer    ,
	data_matricula       date    ,
	valor_total_curso    decimal(10,2)    ,
	status_mat           varchar(20)    ,
	CONSTRAINT pk_matriculas PRIMARY KEY ( matricula_id ),
	CONSTRAINT fk_matriculas_alunos FOREIGN KEY ( aluno_id ) REFERENCES escola_idiomas.alunos( aluno_id )   ,
	CONSTRAINT fk_matriculas_turmas FOREIGN KEY ( turma_id ) REFERENCES escola_idiomas.turmas( turma_id )   
 );

ALTER TABLE escola_idiomas.matriculas ADD CONSTRAINT chk_status CHECK ( status_mat IN ('Ativa', 'Inativa', 'Concluída') );

CREATE  TABLE escola_idiomas.mensalidades ( 
	matricula_id         integer  NOT NULL  ,
	numero_parcela       integer  NOT NULL  ,
	forma_pagamento_id   integer    ,
	data_vencimento      date    ,
	valor_nominal        decimal(10,2)    ,
	status_pag           varchar(20)    ,
	data_pag             date    ,
	valor_pag            decimal(10,2)    ,
	CONSTRAINT pk_mensalidades PRIMARY KEY ( matricula_id, numero_parcela ),
	CONSTRAINT fk_mensalidades_formas_pagamento FOREIGN KEY ( forma_pagamento_id ) REFERENCES escola_idiomas.formas_pagamento( forma_pagamento_id )   ,
	CONSTRAINT fk_mensalidades_matriculas FOREIGN KEY ( matricula_id ) REFERENCES escola_idiomas.matriculas( matricula_id )   
 );

ALTER TABLE escola_idiomas.mensalidades ADD CONSTRAINT chk_mensalidades_status_pag CHECK ( status_pag IN ('Pendente', 'Vencido', 'Pago') );

CREATE  TABLE escola_idiomas.avaliacoes ( 
	avaliacao_id         integer  NOT NULL  ,
	matricula_id         integer    ,
	professor_id         integer    ,
	data_avaliacao       date    ,
	tipo_avaliacao       varchar(50)    ,
	nota                 decimal(4,2)    ,
	CONSTRAINT pk_avaliacoes PRIMARY KEY ( avaliacao_id ),
	CONSTRAINT fk_avaliacoes_matriculas FOREIGN KEY ( matricula_id ) REFERENCES escola_idiomas.matriculas( matricula_id )   ,
	CONSTRAINT fk_avaliacoes_professores FOREIGN KEY ( professor_id ) REFERENCES escola_idiomas.professores( professor_id )   
 );

ALTER TABLE escola_idiomas.avaliacoes ADD CONSTRAINT chk_valor_nota CHECK ( nota >= 0 AND nota <= 10.0 );

ALTER TABLE escola_idiomas.avaliacoes ADD CONSTRAINT chk_tipo_avaliacao CHECK ( tipo_avaliacao IN ('Prova', 'Trabalho', 'Quiz', 'Participação') );

]]></string>
		</script>
	</layout>
</project>